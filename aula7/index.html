<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de alunos gravando em JSON</title>
    <!-- CSS do Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- JS do Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container my-4">
        <div class="row">
           <div class="col-md-6">
            <!-- Criando o formulario de dados -->
                <form id="formAluno" novalidate>
                    <label for="" class="label-form">Nome:</label>
                    <input type="text" id="nome" class="form-control" required>
                    <label for="" class="label-form">E-mail</label>
                    <input type="email" id="email" class="form-control" required>
                    <label for="" class="label-form">Curso</label>
                    <input type="text" id="curso" class="form-control" required>
                    <button id="btnSalvar" class="btn btn-primary" type="submit">Salvar</button>
                    <button id="btnNovo" class="btn btn-outline-secondary" type="button">Novo</button>
                </form>
            </div>
            <div id="msg" class="alert d-none" role="alert"></div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">Lista de Alunos</div>
                    <div class="card-body p-0"></div>
                    <div class="table-responsive"></div>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nome</th>
                                <th>E-mail</th>
                                <th>Curso</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="ListaAlunos">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card mt-3">
                <div class="card-header">JSON Bruto</div>
                <div class="card-body">
                    <textarea name="JsonArea" id="JsonArea" class="form-control" rows="6"></textarea>
                    
                </div>
            </div>
        </div>
    </div>
    <script>
        // Sistema de Cadastro de Alunos com persistencia em JSON
        (() => {
            const key = 'alunosJSON';
            const jsonFilePath = 'alunos.json';
            let lifeHandler = null;

            const form = document.getElementById('formAluno');
            const nomeEl = document.getElementById('nome');
            const emailEl = document.getElementById('email');
            const cursoEl = document.getElementById('curso');
            const idxEl = document.getElementById('idx');

            const listaEl = document.getElementById('ListaAlunos');

            const JsonArea = document.getElementById('JsonArea'); 

            const msgEl = document.getElementById('msg');

            // Variavel de Estado

            let alunos = [];

            function showMessage(text, type = 'success') {
                msgEl.textConatent = text; // Define o texto da mensagem
                msgEl.className = 'alet alert-' + type;  // Aplica a classe do bootstrap
                msgEl.classList .remove('d-none'); // Remove a classe d-none para exibir a mensagem

                // Remove a mensagem após 2 segundos
                setTimeout(() => {
                    msgEl.classList.add('d-none');
                }, 2500);
            }

            // Salvar os dados no localStorage e atualizar a interface
            // O localStorage vai persistir os dados mesmo após o fechamento do navegador
            function saveStorage() {
                // converter o array de alunos para string JSON e salvar no localStorage
                localStorage.setItem (key, JSON.stringify(alunos));
                // Atualizar a interface apos salvar
                render();
            }

            // Carregar os dados do localStorage
            // Se nao houver dados ou erros, inicializa com um array vazio
            function loadStorage() {
                try {
                    // Tentar recuperar os dados do LocalStorage
                    const raw = localStorage.getItem(key);
                    // Se existir dados, converter de JSON para array, senão usa array vazio
                    alunos = raw ? JSON.parse(raw) : [];
                } catch (error) {
                    // Se houver erro, inicializa com array vazio
                    alunos = [];
                    console.error('Erro ao carregar dados do LocalStorage:', error);
                }
            }
            // Carregar os dados do arquivo JSON fisico usando fetch API
            // Esta função tenta buscar o arquivo alunos.json do servidor
            async function loadFromJSONfile() {
                try {
                    // faz um requisição HTTP GET para buscar o arquivo JSON
                    const response = await fetch(jsonFilePath);
                    // Verificar se a resposta foi bem sucedida (status 200)
                    if (response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    // Converter a resposta para texto
                    const data = await response.Json ();


                    
                }
            } catch (error) {
                console.warn('Não foi possivel carregar dados do arquivo', error);
            }


        })
    </script>
</body>
</html>